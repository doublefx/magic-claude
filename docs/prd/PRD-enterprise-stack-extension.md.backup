# PRD: Enterprise Stack Extension for Everything Claude Code

**Version**: 1.0
**Date**: 2026-01-25
**Author**: Frédéric THOMAS (doublefx)
**Status**: Draft

---

## Executive Summary

Extend the Everything Claude Code plugin to support enterprise polyglot development environments (Python, Java, Groovy) with build tools (Maven, Gradle) and CI/CD pipelines (GitHub Actions, GitLab CI, Bitbucket Pipelines), while maintaining existing JavaScript/TypeScript capabilities with intelligent project-specific hook activation.

---

## Problem Statement

### Current State

The Everything Claude Code plugin is optimized for JavaScript/TypeScript ecosystems:
- **Agents**: Language-agnostic but lack domain expertise for JVM and Python
- **Hooks**: Hardcoded for JS/TS (Prettier, TypeScript, console.log checks)
- **Skills**: Frontend/backend patterns focus on Node.js/React
- **Rules**: Coding style emphasizes JS immutability patterns
- **CI/CD**: Zero support for pipeline generation/management

### Gaps for Enterprise Polyglot Teams

1. **Language Coverage**
   - ❌ No Python-specific code review (PEP 8, type hints, security)
   - ❌ No Java expertise (Google Style, null safety, concurrency)
   - ❌ No Groovy domain knowledge (DSL patterns, metaprogramming)

2. **Build Tool Integration**
   - ❌ No Maven lifecycle awareness (dependency:tree, clean verify vs install)
   - ❌ No Gradle optimization (build cache, configuration cache, task dependencies)
   - ❌ No multi-module project patterns

3. **CI/CD Automation**
   - ❌ No GitHub Actions workflow generation
   - ❌ No GitLab CI pipeline scaffolding
   - ❌ No Bitbucket Pipelines support
   - ❌ No deployment strategy guidance

4. **Hook Limitations**
   - ⚠️ JS/TS hooks fire on all projects (conflicts with Python/Java)
   - ❌ No project-type detection for intelligent hook activation
   - ❌ No Python linting (black, flake8, mypy)
   - ❌ No Java formatting (google-java-format, checkstyle)

---

## Goals and Success Criteria

### Primary Goals

1. **Universal Multi-Language Support**
   - Python, Java, Groovy developers get same quality experience as JS/TS
   - Language-specific agents for code review, security, testing
   - Build tool integration (Maven, Gradle) at parity with npm/yarn/pnpm

2. **CI/CD Pipeline Generation**
   - Generate GitHub Actions, GitLab CI, Bitbucket Pipelines from templates
   - Support multi-stage pipelines (build → test → deploy)
   - Best practices embedded (caching, matrix builds, security scanning)

3. **Intelligent Hook Activation**
   - Hooks activate only for relevant project types
   - JS/TS hooks disabled in Python/Java projects (and vice versa)
   - Project detection via manifest files (package.json, pom.xml, build.gradle)

### Success Metrics

- ✅ Python projects: black/flake8/mypy run on PostToolUse
- ✅ Java projects: google-java-format runs on Edit
- ✅ Maven projects: Build warnings suggest `mvn verify` over `install`
- ✅ Gradle projects: Wrapper enforcement (`./gradlew` vs `gradle`)
- ✅ `/ci-cd` command generates working pipeline for any stack
- ✅ Hooks produce zero false positives across project types
- ✅ All existing JS/TS functionality preserved

---

## Target Users

### Primary Personas

1. **Full-Stack Polyglot Developer**
   - Works across React (frontend), Spring Boot (backend), Python (ML/data)
   - Needs context switching without reconfiguring Claude Code
   - Values consistency in code quality regardless of language

2. **Enterprise Java Developer**
   - Multi-module Maven/Gradle projects
   - GitLab CI pipelines for deployment
   - Needs review for concurrency, null safety, performance

3. **DevOps Engineer**
   - Maintains CI/CD pipelines across GitHub/GitLab/Bitbucket
   - Needs templates for build → test → deploy workflows
   - Values pipeline optimization (caching, parallelization)

4. **Data Engineer (Python)**
   - Python codebases with strict type checking (mypy)
   - AWS/GCP deployment via CI/CD
   - Security scanning (bandit, safety) in pipelines

---

## Technical Architecture

### 1. Project Detection System

**Goal**: Auto-detect project type to activate appropriate hooks/agents.

**Detection Logic**:
```javascript
// scripts/detect-project-type.js
const fs = require('fs');
const path = require('path');

function detectProjectType(cwd) {
  const types = [];

  // Language detection
  if (fs.existsSync(path.join(cwd, 'package.json'))) types.push('nodejs');
  if (fs.existsSync(path.join(cwd, 'pom.xml'))) types.push('maven');
  if (fs.existsSync(path.join(cwd, 'build.gradle')) ||
      fs.existsSync(path.join(cwd, 'build.gradle.kts'))) types.push('gradle');
  if (fs.existsSync(path.join(cwd, 'setup.py')) ||
      fs.existsSync(path.join(cwd, 'pyproject.toml'))) types.push('python');
  if (fs.existsSync(path.join(cwd, 'go.mod'))) types.push('go');

  // CI/CD detection
  if (fs.existsSync(path.join(cwd, '.github/workflows'))) types.push('github-actions');
  if (fs.existsSync(path.join(cwd, '.gitlab-ci.yml'))) types.push('gitlab-ci');
  if (fs.existsSync(path.join(cwd, 'bitbucket-pipelines.yml'))) types.push('bitbucket-pipelines');

  return types;
}
```

**Storage**: Cache in `${cwd}/.claude/project-type.json` with TTL (re-detect if manifest changes).

### 2. Conditional Hook System

**Goal**: Hooks fire only for relevant project types.

**Matcher Enhancement**:
```json
{
  "matcher": "tool == \"Edit\" && tool_input.file_path matches \"\\.py$\" && project_type contains \"python\"",
  "hooks": [
    {
      "type": "command",
      "command": "node \"${CLAUDE_PLUGIN_ROOT}/scripts/hooks/python-format.js\""
    }
  ]
}
```

**Hook Categories**:
- **Universal**: Git workflow, tmux reminders (all projects)
- **Language-Specific**: Prettier (nodejs), black (python), google-java-format (maven/gradle)
- **Build-Specific**: Maven lifecycle, Gradle task suggestions
- **CI/CD-Specific**: Pipeline validation, deployment checks

### 3. Language-Specific Agents

**New Agents**:

| Agent | Purpose | Model | Tools |
|-------|---------|-------|-------|
| `python-reviewer` | PEP 8, type hints, security (bandit patterns) | opus | Read, Grep, Glob, Bash |
| `java-reviewer` | Google Style, null safety, concurrency | opus | Read, Grep, Glob, Bash |
| `groovy-reviewer` | DSL patterns, metaprogramming, Spock tests | sonnet | Read, Grep, Glob, Bash |
| `maven-expert` | Dependency management, multi-module, lifecycle | sonnet | Read, Grep, Bash |
| `gradle-expert` | Task optimization, build cache, Kotlin DSL | sonnet | Read, Grep, Bash |
| `ci-cd-architect` | Pipeline design, caching, security scanning | opus | Read, Write, Bash |

**Agent Structure** (Example: `agents/python-reviewer.md`):
```markdown
---
name: python-reviewer
description: Python code review specialist. Reviews for PEP 8, type hints, security, performance. Use after editing Python files.
tools: Read, Grep, Glob, Bash
model: opus
---

You are a senior Python developer and code reviewer.

## Review Checklist

### Critical (Security)
- No eval() or exec() usage
- SQL injection prevention (parameterized queries)
- No hardcoded credentials
- Input validation (Pydantic schemas)
- Dependency vulnerabilities (safety, pip-audit)

### High (Type Safety & Correctness)
- Type hints on all public functions
- mypy compliance (no Any types without justification)
- Proper exception handling (no bare except:)
- Resource cleanup (context managers)

### Medium (Code Quality)
- PEP 8 compliance (black formatted)
- Function size (<50 lines)
- Cyclomatic complexity (<10)
- No duplicated code
- Docstrings on public APIs

### Performance
- List comprehensions over map/filter
- Generator expressions for large datasets
- Proper use of built-ins (any(), all(), zip())
- Avoid N+1 queries (ORM patterns)

## Tools to Run

If available:
- `black --check ${file}` - Formatting
- `flake8 ${file}` - Linting
- `mypy ${file}` - Type checking
- `bandit -r ${directory}` - Security scanning

## Output Format

```
[CRITICAL] SQL Injection Risk
File: app/db.py:42
Issue: String interpolation in SQL query
Fix: Use parameterized queries

# Bad
query = f"SELECT * FROM users WHERE id = {user_id}"

# Good
query = "SELECT * FROM users WHERE id = %s"
cursor.execute(query, (user_id,))
```
```

### 4. Build Tool Skills

**New Skills**:

| Skill | Content |
|-------|---------|
| `skills/maven-patterns/` | Multi-module projects, dependency management, lifecycle best practices |
| `skills/gradle-patterns/` | Build cache, configuration cache, task optimization, Kotlin DSL |
| `skills/python-patterns/` | Project structure, packaging (setuptools, poetry), virtual envs |
| `skills/groovy-patterns/` | DSL design, AST transformations, Spock testing |

**Skill Structure** (Example: `skills/maven-patterns/skill.md`):
```markdown
# Maven Best Practices

## Multi-Module Projects

### Directory Structure
parent/
├── pom.xml                 # Parent POM (packaging=pom)
├── module-api/             # API contracts
├── module-core/            # Business logic
└── module-web/             # REST controllers

### Parent POM Pattern
- Define `<dependencyManagement>` for version control
- Use `<pluginManagement>` for consistent builds
- Inherit from `spring-boot-starter-parent` or company parent

## Dependency Management

### Scope Best Practices
- `compile`: Default (transitive dependencies included)
- `provided`: Container-provided (e.g., servlet-api)
- `test`: Test-only (JUnit, Mockito)
- `runtime`: Execution-only (JDBC drivers)

### Version Management
```xml
<properties>
  <spring.version>5.3.20</spring.version>
</properties>

<dependencyManagement>
  <dependencies>
    <dependency>
      <groupId>org.springframework</groupId>
      <artifactId>spring-core</artifactId>
      <version>${spring.version}</version>
    </dependency>
  </dependencies>
</dependencyManagement>
```

## Lifecycle Optimization

### Fast Local Builds
```bash
mvn clean verify          # Recommended (no install to local repo)
mvn clean verify -T 1C    # Parallel (1 thread per core)
mvn verify -DskipTests    # Skip tests (use sparingly)
```

### CI/CD Builds
```bash
mvn clean verify -B       # Batch mode (no color, simpler logs)
mvn clean verify -U       # Update snapshots
mvn verify -Pcoverage     # With code coverage profile
```

## Common Pitfalls

1. **Using `install` instead of `verify`**
   - `install` copies to ~/.m2/repository (slow, unnecessary in CI)
   - Use `verify` unless other local projects depend on this artifact

2. **Not using dependency:tree**
   - `mvn dependency:tree` - Find version conflicts
   - `mvn dependency:analyze` - Find unused/undeclared deps

3. **Snapshot dependencies in production**
   - SNAPSHOTs are mutable (builds non-reproducible)
   - Use release versions for production

## Plugin Configuration

### Compiler Plugin
```xml
<plugin>
  <groupId>org.apache.maven.plugins</groupId>
  <artifactId>maven-compiler-plugin</artifactId>
  <version>3.11.0</version>
  <configuration>
    <release>17</release>
    <compilerArgs>
      <arg>-parameters</arg>  <!-- Preserve parameter names -->
    </compilerArgs>
  </configuration>
</plugin>
```
```

### 5. CI/CD Pipeline Generator

**New Command**: `/ci-cd`

**Workflow**:
1. Detect project type (maven, gradle, python, nodejs)
2. Ask user: Target platform (GitHub Actions, GitLab CI, Bitbucket)
3. Ask user: Deployment target (AWS, GCP, Azure, Docker Hub, none)
4. Generate pipeline YAML with:
   - Build stage (dependency caching)
   - Test stage (parallel test execution)
   - Security scan stage (SAST, dependency scan)
   - Deploy stage (conditional on branch)

**Template Structure**:
skills/ci-cd-templates/
├── github-actions/
│   ├── maven.yml
│   ├── gradle.yml
│   ├── python.yml
│   └── nodejs.yml
├── gitlab-ci/
│   ├── maven.yml
│   ├── gradle.yml
│   ├── python.yml
│   └── nodejs.yml
└── bitbucket-pipelines/
    ├── maven.yml
    ├── gradle.yml
    ├── python.yml
    └── nodejs.yml

**Example Template** (`skills/ci-cd-templates/github-actions/maven.yml`):
```yaml
name: Maven CI/CD

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

env:
  JAVA_VERSION: '17'
  MAVEN_OPTS: '-Dmaven.repo.local=.m2/repository'

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Set up JDK ${{ env.JAVA_VERSION }}
      uses: actions/setup-java@v4
      with:
        java-version: ${{ env.JAVA_VERSION }}
        distribution: 'temurin'
        cache: 'maven'

    - name: Build with Maven
      run: mvn clean verify -B

    - name: Run tests
      run: mvn test -B

    - name: Upload test results
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: test-results
        path: '**/target/surefire-reports/*.xml'

  security-scan:
    runs-on: ubuntu-latest
    needs: build

    steps:
    - uses: actions/checkout@v4

    - name: Run OWASP Dependency Check
      run: mvn org.owasp:dependency-check-maven:check

    - name: Upload dependency check report
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: dependency-check-report
        path: '**/target/dependency-check-report.html'

  deploy:
    runs-on: ubuntu-latest
    needs: [build, security-scan]
    if: github.ref == 'refs/heads/main'

    steps:
    - uses: actions/checkout@v4

    - name: Set up JDK ${{ env.JAVA_VERSION }}
      uses: actions/setup-java@v4
      with:
        java-version: ${{ env.JAVA_VERSION }}
        distribution: 'temurin'
        cache: 'maven'

    - name: Build JAR
      run: mvn clean package -DskipTests -B

    - name: Deploy to AWS
      # Add deployment logic here
      run: echo "Deploy to AWS"
```

---

## Implementation Phases

### Phase 1: Foundation (Week 1)

**Goal**: Project detection and intelligent hook system.

| Task | Description | Effort | Acceptance Criteria |
|------|-------------|--------|---------------------|
| P1-01 | Create project type detection script | M | Detects nodejs, maven, gradle, python, go from manifest files |
| P1-02 | Implement project type caching | S | Stores in `.claude/project-type.json` with TTL |
| P1-03 | Extend hook matcher syntax | M | Supports `project_type contains "python"` |
| P1-04 | Refactor existing hooks with conditionals | L | JS/TS hooks only fire on nodejs projects |
| P1-05 | Create SessionStart hook for detection | S | Auto-detects project type on session start |

**Deliverables**:
- `scripts/detect-project-type.js`
- `scripts/hooks/session-start.js` (enhanced)
- `hooks/hooks.json` (refactored with project_type matchers)

---

### Phase 2: Python Support (Week 2)

**Goal**: Full Python ecosystem support.

| Task | Description | Effort | Acceptance Criteria |
|------|-------------|--------|---------------------|
| P2-01 | Create Python reviewer agent | L | Reviews for PEP 8, type hints, security |
| P2-02 | Create Python patterns skill | M | Project structure, packaging, virtual envs |
| P2-03 | Add Python style rules | S | PEP 8, type hints, docstrings |
| P2-04 | Python PostToolUse hooks | M | black, flake8, mypy on Edit |
| P2-05 | Python security checks | M | bandit patterns, no eval/exec warnings |

**Deliverables**:
- `agents/python-reviewer.md`
- `skills/python-patterns/skill.md`
- `rules/python-style.md`
- `scripts/hooks/python-format.js`
- `scripts/hooks/python-security.js`

---

### Phase 3: Java/Groovy Support (Week 3)

**Goal**: JVM ecosystem support (Java, Groovy, Kotlin).

| Task | Description | Effort | Acceptance Criteria |
|------|-------------|--------|---------------------|
| P3-01 | Create Java reviewer agent | L | Google Style, null safety, concurrency |
| P3-02 | Create Groovy reviewer agent | M | DSL patterns, metaprogramming, Spock |
| P3-03 | Add Java style rules | S | Google Java Style Guide |
| P3-04 | Java PostToolUse hooks | M | google-java-format on Edit |
| P3-05 | Java security checks | M | No reflection abuse, SQL injection |

**Deliverables**:
- `agents/java-reviewer.md`
- `agents/groovy-reviewer.md`
- `rules/java-style.md`
- `scripts/hooks/java-format.js`

---

### Phase 4: Build Tools (Week 4)

**Goal**: Maven and Gradle expertise.

| Task | Description | Effort | Acceptance Criteria |
|------|-------------|--------|---------------------|
| P4-01 | Create Maven expert agent | L | Dependency mgmt, multi-module, lifecycle |
| P4-02 | Create Gradle expert agent | L | Task optimization, build cache, Kotlin DSL |
| P4-03 | Maven patterns skill | M | Multi-module, lifecycle, plugins |
| P4-04 | Gradle patterns skill | M | Build cache, configuration cache, tasks |
| P4-05 | Maven PreToolUse hooks | S | Suggest `verify` over `install` |
| P4-06 | Gradle PreToolUse hooks | S | Enforce wrapper (`./gradlew`) |

**Deliverables**:
- `agents/maven-expert.md`
- `agents/gradle-expert.md`
- `skills/maven-patterns/skill.md`
- `skills/gradle-patterns/skill.md`
- `scripts/hooks/maven-suggestions.js`
- `scripts/hooks/gradle-wrapper.js`

---

### Phase 5: CI/CD Pipelines (Week 5-6)

**Goal**: Generate CI/CD pipelines for all platforms.

| Task | Description | Effort | Acceptance Criteria |
|------|-------------|--------|---------------------|
| P5-01 | Create CI/CD architect agent | XL | Pipeline design, caching, security |
| P5-02 | GitHub Actions templates | L | Maven, Gradle, Python, Node.js |
| P5-03 | GitLab CI templates | L | Maven, Gradle, Python, Node.js |
| P5-04 | Bitbucket Pipelines templates | M | Maven, Gradle, Python, Node.js |
| P5-05 | Create `/ci-cd` command | M | Interactive pipeline generator |
| P5-06 | CI/CD best practices skill | M | Caching, parallelization, security |
| P5-07 | Pipeline validation hooks | M | Validate YAML syntax on Write |

**Deliverables**:
- `agents/ci-cd-architect.md`
- `skills/ci-cd-templates/` (3 platforms × 4 languages = 12 templates)
- `commands/ci-cd.md`
- `skills/ci-cd-patterns/skill.md`
- `scripts/hooks/validate-pipeline.js`

---

### Phase 6: Testing & Documentation (Week 7)

**Goal**: Ensure quality and usability.

| Task | Description | Effort | Acceptance Criteria |
|------|-------------|--------|---------------------|
| P6-01 | Test Python hooks on real project | M | black/flake8/mypy run correctly |
| P6-02 | Test Java hooks on Spring Boot app | M | google-java-format works |
| P6-03 | Test Maven/Gradle suggestions | S | Lifecycle hints fire correctly |
| P6-04 | Test CI/CD generation | L | Generate working pipelines for all stacks |
| P6-05 | Update README with new features | M | Document Python/Java/CI-CD support |
| P6-06 | Create migration guide | M | For existing plugin users |
| P6-07 | Contribute agents back to upstream | S | Submit PR with Python/Java agents |

**Deliverables**:
- Test reports for all new features
- `README.md` (updated)
- `MIGRATION.md` (new)
- PR to `affaan-m/everything-claude-code`

---

## Design Decisions

### 1. Project Detection Strategy

**Decision**: File-based detection (manifest files) with caching.

**Rationale**:
- Fast (no git/language detection needed)
- Reliable (manifest files are source of truth)
- Cacheable (TTL prevents repeated checks)
- Cross-platform (works on Windows/Mac/Linux)

**Alternatives Considered**:
- ❌ Language detection via file extensions (unreliable for mixed projects)
- ❌ Git history analysis (slow, not all projects use git)

### 2. Hook Conditional Logic

**Decision**: Extend matcher syntax with `project_type` variable.

**Rationale**:
- Backward compatible (existing matchers still work)
- Declarative (no code changes to hook system)
- Composable (can combine with existing matchers)

**Example**:
```json
{
  "matcher": "tool == \"Edit\" && tool_input.file_path matches \"\\.py$\" && project_type contains \"python\"",
  "hooks": [...]
}
```

**Alternatives Considered**:
- ❌ Separate hook files per project type (duplication)
- ❌ Runtime hook filtering in Node.js (requires core changes)

### 3. Agent Specialization

**Decision**: Create language-specific reviewer agents (python-reviewer, java-reviewer) rather than enhancing generic code-reviewer.

**Rationale**:
- **Domain Expertise**: Each language has unique patterns (Python: PEP 8, Java: null safety)
- **Model Selection**: Can use different models (opus for complex, sonnet for fast)
- **Tool Requirements**: Different linters per language (black vs google-java-format)
- **Prompt Size**: Keeps prompts focused (better results)

**Alternatives Considered**:
- ❌ Single generic reviewer with language parameter (prompt too large)
- ❌ Language detection within agent (adds complexity)

### 4. CI/CD Template Structure

**Decision**: YAML templates per platform × language, assembled by agent.

**Rationale**:
- **Maintainability**: Templates are standard YAML (no code generation)
- **Customizability**: Users can fork and edit templates
- **Best Practices**: Each template embeds platform-specific optimizations
- **Composability**: Agent can mix base template + deployment extensions

**Template Inheritance**:
```
base-template.yml          # Common stages (build, test, deploy)
├── maven.yml              # Maven-specific (dependency cache, verify command)
├── gradle.yml             # Gradle-specific (gradle cache, wrapper)
├── python.yml             # Python-specific (pip cache, venv)
└── nodejs.yml             # Node-specific (npm cache, node version)
```

**Alternatives Considered**:
- ❌ Code generation (complex, hard to maintain)
- ❌ Single universal template (too generic, misses optimizations)

### 5. Hook Execution Order

**Decision**: Execute language-agnostic hooks first, then language-specific.

**Order**:
1. Universal hooks (tmux check, git push review)
2. Language-specific hooks (black for Python, Prettier for JS)
3. Security hooks (credential scanning, dependency checks)

**Rationale**:
- Fast failures (tmux check fails immediately)
- Formatting before validation (prettier → typescript check)
- Security last (most expensive, only run if earlier checks pass)

---

## Migration Strategy

### For Existing Plugin Users

**Backward Compatibility**: All existing functionality preserved.

**Opt-In Migration**:
1. **No Action Required**: JS/TS projects work as before (project detection auto-enables hooks)
2. **Python Projects**: Hooks auto-activate when `pyproject.toml` or `setup.py` detected
3. **Java Projects**: Hooks auto-activate when `pom.xml` or `build.gradle` detected
4. **Manual Override**: `.claude/project-type.json` can force specific types

**Breaking Changes**: None.

---

## Testing Strategy

### Unit Tests

**Scope**: Individual scripts and functions.

**Tools**: Jest (Node.js test runner)

**Test Cases**:
- `detect-project-type.js`: Correctly identifies project types from manifests
- `python-format.js`: Runs black/flake8 only on .py files
- `java-format.js`: Runs google-java-format only on .java files
- `validate-pipeline.js`: Detects invalid YAML syntax

### Integration Tests

**Scope**: End-to-end workflows.

**Test Projects**:
1. **Python Flask API** (pyproject.toml, pytest)
2. **Spring Boot App** (pom.xml, JUnit)
3. **Gradle Multi-Module** (build.gradle.kts, Kotlin)
4. **React + Node.js** (package.json, Jest)

**Test Scenarios**:
- Edit Python file → black/flake8 run automatically
- Edit Java file → google-java-format runs
- Run `mvn install` → Hook suggests `mvn verify`
- Run `gradle build` → Hook suggests `./gradlew`
- `/ci-cd` command → Generates working GitHub Actions workflow

### Acceptance Tests

**Criteria**:
- ✅ Zero false positives (JS hooks don't fire on Python projects)
- ✅ All language-specific hooks execute within 2 seconds
- ✅ CI/CD templates pass validation (yamllint)
- ✅ Generated pipelines run successfully on target platforms

---

## Security Considerations

### Dependency Vulnerabilities

**Hooks** should detect:
- Python: `safety check`, `pip-audit`
- Maven: `mvn dependency-check:check`
- Gradle: `./gradlew dependencyCheckAnalyze`
- Node.js: `npm audit`, `yarn audit`

**CI/CD Templates** should include:
- OWASP Dependency Check (Maven/Gradle)
- Snyk or Trivy scanning (Docker images)
- SAST tools (SonarQube, CodeQL)

### Credential Scanning

**PreToolUse Hooks** should block:
- Hardcoded API keys (regex patterns)
- AWS credentials (access key format)
- Database passwords in code
- Private SSH keys in repository

**Patterns**:
```javascript
const DANGEROUS_PATTERNS = [
  /sk-[a-zA-Z0-9]{32,}/,           // OpenAI API keys
  /AKIA[0-9A-Z]{16}/,              // AWS access keys
  /ghp_[a-zA-Z0-9]{36}/,           // GitHub personal tokens
  /postgres:\/\/.*:.*@/,            // DB connection strings with passwords
];
```

---

## Documentation Requirements

### User Documentation

1. **README.md Updates**
   - Multi-language support section
   - CI/CD generation guide
   - Project detection explanation

2. **New Guides**
   - `docs/python-setup.md` - Python environment setup
   - `docs/java-setup.md` - JDK, Maven, Gradle installation
   - `docs/ci-cd-guide.md` - Pipeline customization

3. **Agent Documentation**
   - Each agent has inline examples
   - Security checks documented with rationale
   - Tool requirements listed (black, mypy, etc.)

### Developer Documentation

1. **CONTRIBUTING.md Updates**
   - How to add new language support
   - Hook matcher syntax reference
   - Template inheritance patterns

2. **Architecture Docs**
   - `docs/architecture.md` - System design
   - `docs/hooks.md` - Hook execution flow
   - `docs/project-detection.md` - Detection algorithm

---

## Future Enhancements (Out of Scope)

### Phase 7+ Ideas

1. **More Languages**
   - Rust (Cargo, clippy)
   - Go (go.mod, golangci-lint)
   - Kotlin (ktlint, detekt)

2. **Advanced CI/CD**
   - Deployment strategies (blue-green, canary)
   - Multi-cloud pipelines (AWS + GCP)
   - GitOps integration (ArgoCD, Flux)

3. **Performance Optimization**
   - Parallel hook execution
   - Incremental linting (only changed files)
   - Build cache analysis

4. **AI-Powered Features**
   - Auto-fix suggestions (not just detection)
   - Performance profiling
   - Test generation

---

## Success Metrics (Post-Launch)

### Adoption Metrics

- **Fork Count**: Track forks of `doublefx/everything-claude-code`
- **Usage Analytics**: Number of `/ci-cd` command invocations
- **Contribution Rate**: PRs from community for new languages

### Quality Metrics

- **Hook Accuracy**: False positive rate < 1%
- **Pipeline Success**: Generated pipelines pass on first run > 90%
- **Performance**: Hooks execute in < 2 seconds (95th percentile)

### Community Metrics

- **Upstream Contribution**: Python/Java agents merged to `affaan-m/everything-claude-code`
- **Issue Resolution**: <7 day average response time
- **Documentation Quality**: <5% "unclear docs" issues

---

## Risks and Mitigations

### Risk 1: Hook Performance Degradation

**Risk**: Running multiple linters (black, flake8, mypy) on every edit slows down workflow.

**Likelihood**: Medium
**Impact**: High

**Mitigation**:
- Run linters in parallel (Promise.all)
- Cache linter results (file hash-based)
- Provide opt-out via `.claude/disable-hooks.json`

### Risk 2: Platform Fragmentation

**Risk**: GitHub Actions, GitLab CI, Bitbucket have divergent YAML syntax, causing template maintenance burden.

**Likelihood**: High
**Impact**: Medium

**Mitigation**:
- Use common base template structure
- Document platform-specific quirks
- Automate template testing in CI

### Risk 3: False Positive Security Warnings

**Risk**: Regex-based credential detection flags legitimate code patterns.

**Likelihood**: Medium
**Impact**: Medium

**Mitigation**:
- Whitelist patterns (e.g., test fixtures)
- Allow inline suppressions (`# nosec` comments)
- Provide clear error messages with fix suggestions

### Risk 4: Upstream Divergence

**Risk**: `affaan-m/everything-claude-code` releases breaking changes, causing merge conflicts.

**Likelihood**: Low
**Impact**: High

**Mitigation**:
- Subscribe to upstream releases
- Automated merge conflict detection
- Maintain comprehensive test suite

---

## Appendix

### A. Estimated Effort

| Phase | Weeks | Person-Days |
|-------|-------|-------------|
| Phase 1: Foundation | 1 | 5 |
| Phase 2: Python Support | 1 | 5 |
| Phase 3: Java/Groovy Support | 1 | 5 |
| Phase 4: Build Tools | 1 | 5 |
| Phase 5: CI/CD Pipelines | 2 | 10 |
| Phase 6: Testing & Docs | 1 | 5 |
| **Total** | **7** | **35** |

**Assumptions**:
- 1 developer working full-time
- Includes testing and documentation
- Excludes future enhancements (Phase 7+)

### B. Technology Stack

| Component | Technology | Rationale |
|-----------|-----------|-----------|
| Hooks | Node.js | Cross-platform, existing plugin uses JS |
| Templates | YAML | Standard for GitHub/GitLab/Bitbucket |
| Testing | Jest | Node.js test runner, good IDE support |
| Linters | black, flake8, mypy, google-java-format | Industry standards |
| CI/CD | GitHub Actions | For testing the plugin itself |

### C. Related Work

- **Upstream Plugin**: `affaan-m/everything-claude-code` (JS/TS focused)
- **Python Linting**: PEP 8, black documentation
- **Java Style**: Google Java Style Guide
- **CI/CD**: GitHub Actions, GitLab CI, Bitbucket Pipelines docs

---

## Changelog

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 1.0 | 2026-01-25 | Frédéric THOMAS | Initial PRD draft |

---

**Approval**:
- [ ] Technical Review
- [ ] Stakeholder Sign-Off
- [ ] Resource Allocation
